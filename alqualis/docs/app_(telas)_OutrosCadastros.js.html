<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app/(telas)/OutrosCadastros.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app/(telas)/OutrosCadastros.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect } from 'react';
import { View, Alert } from 'react-native';
import HeaderTitle from '../../components/personalizados/headerTtitle';
import Cores from '../../constants/Cores';
import Botao from '../../components/personalizados/Botao';
import ViewCenter from '../../components/personalizados/ViewCenter';
import Label from '../../components/personalizados/Label';
import { router, useLocalSearchParams } from 'expo-router';
import {
  inserirGenerico,
  buscarRegistroGenericoPorId,
  atualizarGenerico,
  excluirGenerico
} from '../../database/database';
import { RFValue } from 'react-native-responsive-fontsize';

// üîπ Fun√ß√£o utilit√°ria para mapear id ‚Üí nome da tabela
const getNomeTabelaPorId = (id) => {
  const map = {
    '1': 'cooperativa',
    '2': 'municipio',
    '3': 'comunidade',
    '4': 'face_exposicao',
    '5': 'variedade',
  };
  return map[id] || null;
};

/**
 *
 * @description Tela para outros cadastros, aqueles que possuem apenas o campo nome
 */
export default function OutrosCadastros() {
  const { label, id, id_cadastro, titulo } = useLocalSearchParams();
  const [nome, setNome] = useState('');
  const [formSubmitted, setFormSubmitted] = useState(false);

  const cadastroMap = {
    '1': {
      table: 'cooperativa',
      field: 'nome_cooperativa',
      success: 'Cooperativa cadastrada com sucesso!',
    },
    '2': {
      table: 'municipio',
      field: 'nome_municipio',
      success: 'Munic√≠pio cadastrado com sucesso!',
    },
    '3': {
      table: 'comunidade',
      field: 'nome_comunidade',
      success: 'Comunidade cadastrada com sucesso!',
    },
    '4': {
      table: 'face_exposicao',
      field: 'nome_face_exposicao',
      success: 'Face de exposi√ß√£o cadastrada com sucesso!',
    },
    '5': {
      table: 'variedade',
      field: 'nome_variedade',
      success: 'Variedade cadastrada com sucesso!',
    },
  };

  const config = cadastroMap[id];

  // üî∏ Carrega dados se for edi√ß√£o
  useEffect(() => {
    const carregarDados = async () => {
      if (!id_cadastro || !config) return;

      const nomeTabela = getNomeTabelaPorId(id);
      if (!nomeTabela) return;

      const registro = await buscarRegistroGenericoPorId(nomeTabela, Number(id_cadastro));
      //console.log(registro)
      if (registro &amp;&amp; config.field) {
        setNome(registro[config.field] || '');
      }
    };

    carregarDados();
  }, [id, id_cadastro]);

  const handleSalvar = async () => {
    setFormSubmitted(true);

    if (!nome.trim()) {
      Alert.alert('Aten√ß√£o!', 'O nome n√£o pode estar vazio.');
      return;
    }

    if (!config) {
      Alert.alert('Erro', 'Tipo de cadastro inv√°lido.');
      return;
    }

    try {
      const payload = { [config.field]: nome.toUpperCase() };
      const resultId = await inserirGenerico(
        config.table,
        payload,
        config.success
      );
      if (resultId) {
        //console.log(`‚úÖ ${label} cadastrado(a) com ID: ${resultId}`);
        setNome('');
        setFormSubmitted(false);
      }
    } catch (error) {
      //console.error(`‚ùå Erro ao cadastrar ${label}:`, error);
      Alert.alert('Erro', `N√£o foi poss√≠vel cadastrar ${label}.\n${error}`);
    }
  };

  const handleAtualizar = async () => {
  setFormSubmitted(true);

  if (!nome.trim()) {
    Alert.alert('Aten√ß√£o!', 'O nome n√£o pode estar vazio.');
    return;
  }

  if (!config || !id_cadastro) {
    Alert.alert('Erro', 'Informa√ß√µes de edi√ß√£o inv√°lidas.');
    return;
  }

  try {
    const sucesso = await atualizarGenerico(
      config.table,
      config.field,
      nome.toUpperCase(),
      Number(id_cadastro),
      `${titulo} atualizado com sucesso!`
    );

    if (sucesso) {
      //console.log(`‚úÖ ${titulo} atualizado(a) com ID: ${id_cadastro}`);
      setFormSubmitted(false);
      router.back();
    }

  } catch (error) {
    //console.error(`‚ùå Erro ao atualizar ${titulo}:`, error);
    Alert.alert('Erro', `N√£o foi poss√≠vel atualizar ${titulo}.\n${error}`);
  }
};

const handleExcluir = async () => {
  if (!config || !id_cadastro) {
    Alert.alert('Erro', 'Informa√ß√µes para exclus√£o inv√°lidas.');
    return;
  }

  Alert.alert(
    'Confirmar exclus√£o',
    `Tem certeza que deseja excluir este(a) ${titulo?.toLowerCase()}?`,
    [
      { text: 'Cancelar', style: 'cancel' },
      {
        text: 'Excluir',
        style: 'destructive',
        onPress: async () => {
          try {
            const sucesso = await excluirGenerico(config.table, Number(id_cadastro));
            if (sucesso) {
              //console.log(`üóëÔ∏è ${titulo} exclu√≠do(a) com ID: ${id_cadastro}`);
              router.back(); // volta para a tela anterior
            }
          } catch (error) {
            //console.error(`‚ùå Erro ao excluir ${titulo}:`, error);
            Alert.alert('Erro', `N√£o foi poss√≠vel excluir ${titulo}.\n${error}`);
          }
        }
      }
    ]
  );
};

  return (
    &lt;View style={{ flex: 1, backgroundColor: Cores.verde, paddingBottom:RFValue(30) }}>
      {titulo &amp;&amp;
      &lt;HeaderTitle texto={`Editar ${titulo}`} voltar="true" home="true" />
      }
       {!titulo &amp;&amp;
      &lt;HeaderTitle texto={`Cadastrar ${label}`} voltar="true" home="true" />
      }     
      &lt;ViewCenter>
        &lt;Label
          label="Nome"
          input={true}
          onChangeText={setNome}
          value={nome}
          required
          showError={formSubmitted}
          verificarDuplicado={{
            tabela: config?.table,
            campo: config?.field,
          }}
          mensagemDuplicadoPersonalizada={`J√° existe um(a) ${label?.toLowerCase()} com esse nome.`}
        />
      &lt;/ViewCenter>
      {!id_cadastro &amp;&amp;
        &lt;Botao texto='Salvar' onPress={handleSalvar} /> 
      }     
      
      {id_cadastro &amp;&amp;
      &lt;>
        &lt;Botao texto='Editar' onPress={handleAtualizar} cor={Cores.azul} foto = 'create-outline'/> 
        &lt;Botao texto='Excluir' onPress={handleExcluir} cor={Cores.vermelho} foto='trash-outline' /> 
      &lt;/>
      }  
    &lt;/View>
  );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#DropdownComponent">DropdownComponent</a></li><li><a href="global.html#ImportarPlanilhaExcel">ImportarPlanilhaExcel</a></li><li><a href="global.html#associarProdutorCooperativa">associarProdutorCooperativa</a></li><li><a href="global.html#atualizarGenerico">atualizarGenerico</a></li><li><a href="global.html#atualizarPlantacao">atualizarPlantacao</a></li><li><a href="global.html#atualizarProdutor">atualizarProdutor</a></li><li><a href="global.html#buscarPlantacaoPorId">buscarPlantacaoPorId</a></li><li><a href="global.html#buscarPlantacoesDetalhadas">buscarPlantacoesDetalhadas</a></li><li><a href="global.html#buscarProdutorPorId">buscarProdutorPorId</a></li><li><a href="global.html#buscarProdutoresCooperativa">buscarProdutoresCooperativa</a></li><li><a href="global.html#buscarRegistroGenericoPorId">buscarRegistroGenericoPorId</a></li><li><a href="global.html#buscarRegistrosComFiltro">buscarRegistrosComFiltro</a></li><li><a href="global.html#buscarRegistrosGenericos">buscarRegistrosGenericos</a></li><li><a href="global.html#buscarTudoUnificado">buscarTudoUnificado</a></li><li><a href="global.html#createDatabase">createDatabase</a></li><li><a href="global.html#deleteDatabase">deleteDatabase</a></li><li><a href="global.html#excluirGenerico">excluirGenerico</a></li><li><a href="global.html#excluirPlantacao">excluirPlantacao</a></li><li><a href="global.html#excluirProdutor">excluirProdutor</a></li><li><a href="global.html#fs">fs</a></li><li><a href="global.html#inserirGenerico">inserirGenerico</a></li><li><a href="global.html#inserirPlantacao">inserirPlantacao</a></li><li><a href="global.html#inserirProdutor">inserirProdutor</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Jul 30 2025 12:08:10 GMT-0300 (Hor√°rio Padr√£o de Bras√≠lia)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
