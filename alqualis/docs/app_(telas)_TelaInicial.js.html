<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app/(telas)/TelaInicial.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app/(telas)/TelaInicial.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, {useState} from 'react';
import {
  View, Text, StyleSheet, Modal
} from 'react-native';
import HeaderTitle from '../../components/personalizados/headerTtitle';
import Cores from '../../constants/Cores';
import Botao from '../../components/personalizados/Botao';
import ViewCenter from '../../components/personalizados/ViewCenter'
import { router, useLocalSearchParams } from 'expo-router';
import * as FileSystem from 'expo-file-system';
import * as Sharing from 'expo-sharing';
import * as XLSX from 'xlsx';
import {createDatabase,
  deleteDatabase,
  buscarTudoUnificado,
} from '../../database/database';
import Carregando from '../../components/personalizados/Carregando';
import { ImportarPlanilhaExcel } from '../../hooks/ImportarPlanilha';
import PrefixoModal from '../../components/personalizados/PrefixoModal';

/**
 * 
 * @description Tela inicial, que contÃ©m os botÃµes para os mÃ³dulos
 */
export default function TelaInicial() {  
  const {produtor=false, plantacao=false , outros=false, titulo, funcao=false} = useLocalSearchParams()
    
  const [modalVisible, setModalVisible] = useState(false);  
    
    
    
  const [loading, setLoading] = useState(false);
  // â¬‡ FunÃ§Ã£o chamada ao pressionar o botÃ£o "Importar"
    const handleImportar = () => {
      setModalVisible(true);
    };
  
    // â¬‡ Quando o usuÃ¡rio confirma o prefixo no modal
    const handlePrefixoConfirmado = async (prefixo) => {
      setModalVisible(false);
      await ImportarPlanilhaExcel(setLoading, prefixo);
    };
  const handleCriarBanco = async () => {
      try {
        // Se vocÃª quiser mostrar algum feedback extra:
        // Alert.alert("Aguarde", "Criando o banco de dadosâ€¦");
  
        await createDatabase(true);
        // Opcional: faÃ§a algo apÃ³s a criaÃ§Ã£o, como navegar ou recarregar dados
      } catch (error) {
        // A prÃ³pria createDatabase jÃ¡ exibe um Alert em caso de erro,
        // mas abaixo vocÃª poderia tratar logs adicionais:
        Alert.alert("Erro ao criar banco na UI:", error);
      }
    };
  /**
   * 
   * @description FunÃ§Ã£o responsÃ¡vel por exportar os dados do aplicativo para uma planilha excel
   */
  const handleExportar = async () => {
  try {
    const registros = await buscarTudoUnificado();

    // registros.forEach((registro, index) => {
    //   console.log(`Registro ${index + 1}:`, registro);
    // });
    
    if (!registros || registros.length === 0) {
      Alert.alert('Aviso', 'Nenhum dado encontrado para exportar.');
      return;
    }

    // Converte os arrays de meses_colheita para string
    const registrosFormatados = registros.map(item => {
      const formatado = { ...item };
      if (Array.isArray(item["Meses de Colheita"])) {
        formatado["Meses de Colheita"] = item["Meses de Colheita"].join(', ');
      }
      return formatado;
    });

    // Cria a planilha a partir do JSON
    const worksheet = XLSX.utils.json_to_sheet(registrosFormatados);

    // ðŸ”„ Define a largura das colunas com base no conteÃºdo
    const keys = Object.keys(registrosFormatados[0]);
    const colWidths = keys.map(key => {
      const maxLen = Math.max(
        key.length,
        ...registrosFormatados.map(row => (row[key] ? row[key].toString().length : 0))
      );
      return { wch: Math.min(Math.max(maxLen + 2, 10), 40) }; // entre 10 e 40 caracteres
    });
    worksheet['!cols'] = colWidths;

    // ðŸ§­ Centraliza o conteÃºdo de todas as cÃ©lulas
    Object.keys(worksheet).forEach(cell => {
      if (cell[0] === '!') return; // ignora metadados
      worksheet[cell].s = {
        alignment: { horizontal: 'center', vertical: 'center', wrapText: true }
      };
    });

    const workbook = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(workbook, worksheet, 'Resumo Amostras');

    // Gera a string base64 do Excel
    const excelBase64 = XLSX.write(workbook, {
      type: 'base64',
      bookType: 'xlsx',
      cellStyles: true // necessÃ¡rio para estilos
    });

    // Salva e compartilha
    const fileUri = FileSystem.documentDirectory + 'exportacao.xlsx';
    await FileSystem.writeAsStringAsync(fileUri, excelBase64, {
      encoding: FileSystem.EncodingType.Base64,
    });

    await Sharing.shareAsync(fileUri, {
      mimeType: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
      dialogTitle: 'Exportar dados para Excel',
      UTI: 'com.microsoft.excel.xlsx',
    });

  } catch (error) {
    //console.error('Erro ao exportar:', error);
    Alert.alert('Erro', `Erro ao exportar para Excel.\n${error}`);
  }
};  
  return (
    &lt;View style={{flex: 1, backgroundColor:Cores.verde }}>
      &lt;HeaderTitle  texto={titulo} voltar={true} home = {true}/>
      &lt;ViewCenter>
        {produtor &amp;&amp;
            &lt;>
                &lt;Botao texto='Cadastrar Produtor' foto='person-add-outline'
                cor={Cores.marrom}
                onPress={() => router.push('(telas)/CadastrarProdutor')}
                />
                &lt;Botao texto='Visualizar Produtor' foto='eye-outline'
                cor={Cores.marrom}
                onPress={() => router.push({ pathname: '(telas)/Visualizar', params: { titulo: 'Produtor', id: '1' } })}
                />
            &lt;/>
        }
        
        {plantacao &amp;&amp;
        &lt;>
            &lt;Botao texto='Cadastrar PlantaÃ§Ã£o' foto='leaf-outline'
            cor={Cores.azul}
            onPress={() => router.push('(telas)/CadastrarPlantacao')}
            />
            &lt;Botao texto='Visualizar PlantaÃ§Ã£o' foto='eye-outline'
            cor={Cores.azul}
            onPress={() => router.push({ pathname: '(telas)/Visualizar', params: { titulo: 'PlantaÃ§Ã£o', id: '2', cor:Cores.azul } })}
            />
        
        &lt;/>
        }
        
        {outros &amp;&amp;
        &lt;>
            &lt;Botao texto='Cadastrar Cooperativa' foto='storefront-outline'
            cor={Cores.caramelo}
            onPress={() => router.push({ pathname: '(telas)/OutrosCadastros', params: { label: 'Cooperativa', id: '1' } })}
            />
            &lt;Botao texto='Visualizar Cooperativas' foto='eye-outline'
            cor={Cores.caramelo}
            onPress={() => router.push({ pathname: '(telas)/Visualizar', params: { titulo: 'Cooperativa', id: '3',cor:Cores.caramelo } })}
            />

            &lt;Botao texto='Cadastrar MunicÃ­pio' foto='business-outline'
            cor={Cores.verdeMusgo}
            onPress={() => router.push({ pathname: '(telas)/OutrosCadastros', params: { label: 'MunicÃ­pio', id: '2' } })}
            />
            &lt;Botao texto='Visualizar MunicÃ­pio' foto='eye-outline'
            cor={Cores.verdeMusgo}
            onPress={() => router.push({ pathname: '(telas)/Visualizar', params: { titulo: 'MunicÃ­pio', id: '4',cor:Cores.verdeMusgo } })}
            />

            &lt;Botao texto='Cadastrar Comunidade' foto='people-outline'
            cor={Cores.terracota}
            onPress={() => router.push({ pathname: '(telas)/OutrosCadastros', params: { label: 'Comunidade', id: '3' } })}
            />
            &lt;Botao texto='Visualizar Comunidades' foto='eye-outline'
            cor={Cores.terracota}
            onPress={() => router.push({ pathname: '(telas)/Visualizar', params: { titulo: 'Comunidade', id: '5',cor:Cores.terracota } })}
            />

            &lt;Botao texto='Cadastrar Face de ExposiÃ§Ã£o' foto='sunny-outline'
            cor={Cores.oliva}
            onPress={() => router.push({ pathname: '(telas)/OutrosCadastros', params: { label: 'Face de ExposiÃ§Ã£o', id: '4' } })}
            />
            &lt;Botao texto='Visualizar Face de ExposiÃ§Ã£o' foto='eye-outline'
            cor={Cores.oliva}
            onPress={() => router.push({ pathname: '(telas)/Visualizar', params: { titulo: 'Face de ExposiÃ§Ã£o', id: '6',cor:Cores.oliva } })}
            />

            &lt;Botao texto='Cadastrar Variedade' foto='eyedrop-outline'
            cor={Cores.vinho}
            onPress={() => router.push({ pathname: '(telas)/OutrosCadastros', params: { label: 'Variedade', id: '5' } })}
            />
            &lt;Botao texto='Visualizar Variedade' foto='eye-outline'
            cor={Cores.vinho}
            onPress={() => router.push({ pathname: '(telas)/Visualizar', params: { titulo: 'Variedade', id: '7',cor: Cores.vinho } })}
            />
        
        &lt;/>
        }     

        {funcao &amp;&amp;
          &lt;>
            &lt;Botao texto='Criar Banco' cor={Cores.azul} onPress={()=>handleCriarBanco()} />
            &lt;Botao texto='Apagar Banco' cor={Cores.vermelho} onPress={() => deleteDatabase()} foto='trash-outline'/>
            &lt;Botao texto='Importar' cor={Cores.vinho} onPress={() =>handleImportar()} foto='download-outline'/>
            &lt;Carregando visible={loading}/>
            &lt;Botao texto='Exportar' cor={Cores.caramelo} onPress={() =>handleExportar()} foto='share-outline'/>          
          
          &lt;/>
          
        }   

        {/* â¬‡ MODAL DE PREFIXO */}
        &lt;PrefixoModal
          visible={modalVisible}
          onConfirm={handlePrefixoConfirmado}
          onCancel={() => setModalVisible(false)}
        />
       
      &lt;/ViewCenter>
      
    &lt;/View>
  );
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#DropdownComponent">DropdownComponent</a></li><li><a href="global.html#ImportarPlanilhaExcel">ImportarPlanilhaExcel</a></li><li><a href="global.html#associarProdutorCooperativa">associarProdutorCooperativa</a></li><li><a href="global.html#atualizarGenerico">atualizarGenerico</a></li><li><a href="global.html#atualizarPlantacao">atualizarPlantacao</a></li><li><a href="global.html#atualizarProdutor">atualizarProdutor</a></li><li><a href="global.html#buscarPlantacaoPorId">buscarPlantacaoPorId</a></li><li><a href="global.html#buscarPlantacoesDetalhadas">buscarPlantacoesDetalhadas</a></li><li><a href="global.html#buscarProdutorPorId">buscarProdutorPorId</a></li><li><a href="global.html#buscarProdutoresCooperativa">buscarProdutoresCooperativa</a></li><li><a href="global.html#buscarRegistroGenericoPorId">buscarRegistroGenericoPorId</a></li><li><a href="global.html#buscarRegistrosComFiltro">buscarRegistrosComFiltro</a></li><li><a href="global.html#buscarRegistrosGenericos">buscarRegistrosGenericos</a></li><li><a href="global.html#buscarTudoUnificado">buscarTudoUnificado</a></li><li><a href="global.html#createDatabase">createDatabase</a></li><li><a href="global.html#deleteDatabase">deleteDatabase</a></li><li><a href="global.html#excluirGenerico">excluirGenerico</a></li><li><a href="global.html#excluirPlantacao">excluirPlantacao</a></li><li><a href="global.html#excluirProdutor">excluirProdutor</a></li><li><a href="global.html#fs">fs</a></li><li><a href="global.html#inserirGenerico">inserirGenerico</a></li><li><a href="global.html#inserirPlantacao">inserirPlantacao</a></li><li><a href="global.html#inserirProdutor">inserirProdutor</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Jul 30 2025 12:08:10 GMT-0300 (HorÃ¡rio PadrÃ£o de BrasÃ­lia)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
